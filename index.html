<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Quick Share</title>
        <style>
            body {
                font-family: "Segoe UI", sans-serif;
                background-color: #f4f6f9;
                margin: 0;
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            h2 {
                color: #333;
            }

            .chat-container {
                background: #fff;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                max-width: 600px;
                width: 100%;
            }

            #messages {
                list-style-type: none;
                padding: 10px;
                height: 300px;
                overflow-y: auto;
                border: 1px solid #ddd;
                margin: 15px 0;
                border-radius: 8px;
                background-color: #fafafa;
            }

            #messages div {
                padding: 8px 10px;
                margin-bottom: 8px;
                background-color: #e3f2fd;
                border-radius: 6px;
            }

            .form-group {
                margin-bottom: 12px;
                display: flex;
                gap: 10px;
            }

            input[type="text"],
            input[type="file"] {
                flex: 1;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 6px;
            }

            button {
                padding: 8px 16px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
            }

            button:hover {
                background-color: #0056b3;
            }

            a {
                color: #007bff;
                text-decoration: none;
            }

            a:hover {
                text-decoration: underline;
            }
        </style>
    </head>
    <body>
        <h2>Quick Share</h2>
        <h3>Click the text to copy.Click file to download.</h3>
        <div class="chat-container">
            <div class="form-group">
                <input type="text" id="room" placeholder="Enter unique ID" />
                <button id="submit">Join</button>
            </div>
            <ul id="messages"></ul>
            <div class="form-group">
                <input id="input" type="text" placeholder="Enter message" />
                <button id="textSend">Send</button>
            </div>

            <div class="form-group">
                <input id="file" type="file" />
                <button id="sendFile">Send File</button>
            </div>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            const msg = document.getElementById("messages");
            const room = document.getElementById("room");
            const submit = document.getElementById("submit");
            const input = document.getElementById("input");
            const txtBtn = document.getElementById("textSend");
            const fileInput = document.getElementById("file");
            const sendFileBtn = document.getElementById("sendFile");
            const msgDiv = document.getElementById("msgDiv");
            submit.addEventListener("click", () => {
                socket.emit("joinchat", room.value);
            });

            txtBtn.addEventListener("click", function () {
                if (input.value) {
                    socket.emit("chatmessage", {
                        ip: input.value,
                        rm: room.value,
                    });
                    input.value = "";
                }
            });

            socket.on("newmsg", (data) => {
                const div = document.createElement("div");
                div.innerText = data;
                div.addEventListener("click", () => {
                    navigator.clipboard
                        .writeText(div.innerText)
                        .then(() => {
                            alert("Copied to clipboard!");
                        })
                        .catch((err) => {
                            console.error("Failed to copy: ", err);
                        });
                });

                msg.appendChild(div);
                msg.scrollTop = msg.scrollHeight;
            });

            sendFileBtn.addEventListener("click", () => {
                const file = fileInput.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = () => {
                    socket.emit(
                        "sendFile",
                        {
                            rm: room.value,
                            file: {
                                name: file.name,
                                type: file.type,
                                data: reader.result,
                            },
                        },
                        (status) => {
                            console.log("File sent:", status);
                        }
                    );
                };
                reader.readAsDataURL(file);
            });

            socket.on("newfile", (data) => {
                const div = document.createElement("div");
                const link = document.createElement("a");
                link.href = data.data;
                link.download = data.name;
                link.textContent = `Download: ${data.name}`;
                div.appendChild(link);
                msg.appendChild(div);
            });
        </script>
    </body>
</html>
